title = "listPublicacion"
url = "/listado-de-publicaciones/:search/:type/:interests/:lang"

is_hidden = 0

[staticPage]
useContent = 1
default = 0

[staticMenu]
code = "donde-ir"

[staticMenu staticMenu2]
code = "que-vivir"

[staticMenu staticMenu3]
code = "mi-estancia"

[staticMenu staticMenu4]
code = "que-hacer"

[staticMenu staticMenu5]
code = "footer"

[staticMenu staticMenu6]
code = "redes-sociales"

[staticApp]

==
<?php

	function onStart()
	{
        $this['lang']=\App::getLocale();
        if($this['lang']==''){
            $this['lang']='es';
        }

        $this['startPag'] = 1;
        $this['numberReg'] = 6;

        $this['numPag'] = ceil($this->staticApp->publicacionesFindC($this->param('search'),$this->param('type'),$this->param('interests'),$this->param('lang'))/$this['numberReg']);
        $this['publications'] = $this->staticApp->publicacionesFindPag($this->param('search'),$this->param('type'),$this->param('interests'),$this->param('lang'),$this['startPag'],$this['numberReg']);
        $this['pubcount'] = $this->staticApp->publicacionesFindC($this->param('search'),$this->param('type'),$this->param('interests'),$this->param('lang'));

        $this['ptitle'] = 'Cádiz | Publicaciones';
        $this['metaTitle'] = 'Cádiz | Publicaciones';
    
	}

  function onFindPublicacion(){


    $aLang = App::getLocale();
    
    $psearch = $_POST['search'];
    if($psearch == ''){
      $search = 'todas-las-publicaciones';
    } else {
      $search = str_replace(' ','_',$psearch);
    }

    $type = $_POST['type'];
    $interests = implode('_',$_POST['interests']);
    $lang = $_POST['lang'];
    
    $this['startPag'] = 1;
    $this['numberReg'] = 6;

    $this['numPag'] = ceil($this->staticApp->publicacionesFindC($search,$type,$interests,$lang)/$this['numberReg']);
    $this['publications'] = $this->staticApp->publicacionesFindPag($search,$type,$interests,$lang,$this['startPag'],$this['numberReg']);
    $this['pubcount'] = $this->staticApp->publicacionesFindC($search,$type,$interests,$lang);

    return [
        '#prtlPublicationsl' => $this->renderPartial('publications'),
        '#prtlPagination' => $this->renderPartial('pagination')
    ];

  }

  function onPaginate(){

    $this['startPag'] = $_POST['ipag'];
    $this['numberReg'] = 6;

    $this['numPag'] = ceil($this->staticApp->publicacionesFindC($this->param('search'),$this->param('type'),$this->param('interests'),$this->param('lang'))/$this['numberReg']);
    $this['publications'] = $this->staticApp->publicacionesFindPag($this->param('search'),$this->param('type'),$this->param('interests'),$this->param('lang'),$this['startPag'],$this['numberReg']);
    $this['pubcount'] = $this->staticApp->publicacionesFindC($this->param('search'),$this->param('type'),$this->param('interests'),$this->param('lang'));

    return [
        '#prtlPublicationsl' => $this->renderPartial('publications'),
        '#prtlPagination' => $this->renderPartial('pagination')
    ];
  }

?>
==

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="google-site-verification" content="KZtyPnD_0KXDnRTpmvwxNoBcvj3Osx_VKrXoJaucHrE" />
    <meta property="og:image" content="{{ metaImg }}">
    <meta property="og:title" content="{{ metaTitle }}">
    <meta property="og:description" content="{{ metaDescription }}">
    <title>{{ptitle}}</title>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"/>

    <link rel="stylesheet" type="text/css" href="http://cdn.jsdelivr.net/bootstrap/3/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="http://cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css" />

    <link rel="stylesheet" href="{{url('/')}}/plugins/rainlab/pages/assets/css/style-comarcas.css"/>
    <link rel="stylesheet" href="{{url('/')}}/plugins/rainlab/pages/assets/css/style-village.css"/>
    <link rel="stylesheet" href="{{url('/')}}/plugins/rainlab/pages/assets/css/style-event.css"/>
     
    <link rel="stylesheet" href="{{url('/')}}/plugins/rainlab/pages/assets/css/style.css"/>
    <link rel="apple-touch-icon" sizes="180x180" href="{{url('/')}}/plugins/rainlab/pages/assets/img/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="{{url('/')}}/plugins/rainlab/pages/assets/img/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="{{url('/')}}/plugins/rainlab/pages/assets/img/favicons/favicon-16x16.png">
    <link rel="manifest" href="{{url('/')}}/plugins/rainlab/pages/assets/img/favicons/manifest.json">
    <link rel="mask-icon" href="{{url('/')}}/plugins/rainlab/pages/assets/img/favicons/safari-pinned-tab.svg" color="#175DA3">
    <meta name="theme-color" content="#175DA3">

</head>
  
  {% partial 'device-rotate' %}
  {% partial 'site/header' %}

<!-- HEADER -->
<div class="header-general header-publications header-publications-min">
    <div class="header-container">
        <div class="header-txt">
            <h1 class="txt-rutas"><span class="first-word-rutas">{{ "Publicaciones"|_ }}</span><span class="con-encanto" style="display: block;"> &nbsp</span></h1>
            <img class="brush brushTop" src="{{preurl}}/storage/app/media/uploaded-files/templates/brush-header.svg" alt="">
        </div>
        <!-- SEARCH -->
        <div id='prtlSearch'>
            {% partial "site/searchpub" %}
        </div>
    </div>
</div>
</div>

<div  class="all-events">
  <div id='prtlPublicationsl' class="all-events-container">
    {% partial "publications" %}
  </div>
</div>
<div id='prtlPagination' class="prtlPaginationPub">
  {% partial "pagination" %}
</div>

 {% partial 'site/footer' %}

 <!-- SCRIPTS -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/js/select2.full.min.js"></script>
<script type="text/javascript" src="{{url('/')}}/plugins/rainlab/pages/assets/js/script-select2.js"></script>
<script type="text/javascript" src="{{url('/')}}/plugins/rainlab/pages/assets/iziModal/js/iziModal.js"></script>

<script type="text/javascript" src="{{url('/')}}/plugins/rainlab/pages/assets/js/style.js"></script>

<script type="text/javascript" src="{{url('/')}}/plugins/rainlab/pages/assets/js/mapcadiz.js"></script>

{% framework %}